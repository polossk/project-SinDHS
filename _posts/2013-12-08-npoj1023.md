---
layout: post
title: "NPOJ(BETA) 1023 这个大物有点难(NWPU SRM of 2013.Dec F) 模拟 & 字符串"
date: 2013-12-08 19:45:05 +0800
categories: contest string
tags: acmicpc nwpuacm basicstring
---
<h1 style="color: #000000;">题目——<span style="color: #1a5cc8;">这个大物有点难</span>

<span style="color: #000000;"><strong><span style="color: green;">时间限制:3000MS 内存限制:65536KB </span></strong></span>

<h2 style="color: #000000;"><span style="color: #33ccff;">题目描述</span>

到了大学，自然还是要上大物课的，这不禁让一些同学回想起，在初中的时候，物理课上经常会有一些基本的题目，比方说：``U=10V, I=5A, P=?"。当然这些都是平时上课时的练习题了，到了考试上，我们的题目就变成：“小明去超市买了一个电灯泡，这个灯泡是节能灯，功率很小，标签上注明P=10W。另外，我国的市电电压是U=220V，60Hz。求这个灯泡通电发光时的电流。”你看看，复杂吧！

但是实际上，我们总是经验丰富的去寻找关键词，诸如“电压”“功率”“电流”等等，找到关键信息，从而根据题目要求和所给条件解题目，哪怕是英文的题目我们也从容不迫。比如下面这道题目：``You have an electrical circuit that contains a batter with a voltage of U=10V and a light-bulb. There's an electrical current of I=5A through the bulb. Which power is generated in the bulb?"我们很“实在”的找到了两个关键词“U=10V”和“I=5A”，并且得知问题是求解功率，因此，这道题目就成功的解出来了。

结果，今天的大物考试坑爹了！

题目是这样写的：假设你是一个中学生，如果给你10道计算电压、电流或者功率的题目，你可能手动计算即可。但是你现在面临着有1000道题目的一本盗版辅导资料（我的天！），能不能用一个程序来解决这个问题呢？

<div class="panel_title" style="font-weight: bold; color: #000000;" align="left"><span style="color: #33ccff;">输入</span></div>
输入数据的第一行只包含一个数字，说明总共有多少个问题。

每一个问题都只会包含一行文字，并且保证只会提供两个不重复的已知量让你去求解剩下的那个物理量。每一个已知量都会以类似I=xA， U=xV 或者 P=xW 的方式给出，在这里，x是一个实数。

在单位(A, V or W)的前面可能会有前缀，比方说千瓦(kW)，毫安(mA),兆伏(MV)，当然数据中也会有很平常的瓦(W)，安(A),伏(V)。

总而言之，所有的已知量会按照下列各式给出：

已知量 ::= 物理量名 '=' 实数 [前缀] 单位

物理量名::= 'P' | 'U' | 'I'

前缀 ::= 'm' | 'k' | 'M'

实数 ::= 参见数学上的实数的定义

单位 ::= 'W' | 'V' | 'A'

另外再给一些说明：

在所给的已知量文本中，不会有任何空格和Tab。

在问题中， P 和 U, P 和 I, 或者 U 和 I 都有可能给出。

可能存在物理量名和单位不匹配的情况（&lt;!--打击盗版，人人有责--!&gt;），一旦出现，则认为这个已知量是错误的。我们保证会有两个正确的已知量给出。

所给文本是英文的，请注意，我们也保证在所给数据中不会出现任何中文。

<div class="panel_title" style="font-weight: bold; color: #000000;" align="left"><span style="color: #33ccff;">输出</span></div>
对于每一个问题，请输出三行文本：

第一行请说明问题的序号，格式为“Problem #k”，k是这一组测试数据的序号。

第二行请输出这个问题的答案，并且按照如下格式：

已知量 ::= 物理量名 '=' 答案 单位

物理量名::= 'P' | 'U' | 'I'

答案 ::= 保留两位小数的一个实数

单位 ::= 'W' | 'V' | 'A'

第三行请输出空行以方便区分。

具体的请参见样例输出。

<div class="panel_title" style="font-weight: bold; color: #000000;" align="left"><span style="color: #33ccff;">示例输入</span></div>
<div class="panel_content" style="color: #000000;">

{% highlight plain %}3
If the voltage is U=200V and the current is I=4.5A, which power is generated?
A light-bulb yields P=100W and the voltage is U=220V. Compute the current, please.
bla bla bla lightning strike I=2A bla bla bla P=2.5MW bla bla voltage?
{% endhighlight %}

</div>
<div class="panel_title" style="font-weight: bold; color: #000000;" align="left"><span style="color: #33ccff;">示例输出</span></div>
<div class="panel_content" style="color: #000000;">

{% highlight plain %}Problem #1
P=900.00W

Problem #2
I=0.45A

Problem #3
U=1250000.00V
{% endhighlight %}

</div>
<div class="panel_title" style="font-weight: bold; color: #000000;" align="left"><span style="color: #33ccff;">提示</span></div>
使用C语言的同学请注意，double型的输入输出请使用%lf。

# 题解

<p style="color: #000000;">这道题的目的很简单！从竞赛角度，防止AK虐场；从学习角度，让你们见一下正则表达式；从软件工程角度，让你们知道如何提取关键信息。当然对于你们广大的C初学者，主要目的就是：

<p style="color: #000000;"><span style="color: #ff6666;">面向对象要从娃娃抓起！</span>

<p style="color: #000000;">好了废话少说，题目意思就是让你去提取信息，那我就把坑都告诉你们。

<p style="color: #000000;">你会问，为什么会有坑呢？针对我们竞赛才设计的么？No， No， No，是为了用户才设计的！

<p style="color: #000000;">记着：

<p style="color: #000000;"><span style="color: #ff6666;">面向对象要从娃娃抓起！</span>

<p style="color: #000000;">用户可指不定干出什么事，真的，谁愿意乖乖的按照你们的所谓“规则”“规范”做事，不是吗？所以用户所提交上去的东西会有很多错误，比如说：

<ol style="color: #000000;">
<li>我输入个负数试试！就是为了玩你！</li>
<li>我整一个没有的单位前缀给你，看看你认识不认识！</li>
<li>我整一个没有单位的已知量给你，看看你会不会出错！</li>
<li>我送你一个 电流I = 100 W，对，电流等于100瓦特，我看看你的程序傻不傻，会不会把这个错误信息输进去！</li>
<li>实数是吧，“4.”也是实数，不就加个小数点，你总不能说我这个不是数字了吧！</li>
</ol>
<p style="color: #000000;">OK，这就是这道题目的所有的数据陷阱，比对一下你跳了多少个陷阱吧！

{% highlight cpp %}
/****
	*@PoloShen
	*Title:F - NWPU SRM of 2013.Dec
	*/
#include <iostream>
#include <cstdio>
#include <string>
#include <cstring>
#include <vector>

using namespace std;
double p, u, i;
const char Concept[3] = {'P', 'U', 'I'};
const char Unit[3] = {'W', 'V', 'A'};
const double Unkn = 1<<24;

struct question{
	char Name;
	double Value;
	question(){Name = '';Value = Unkn;}
};
question telled[2];

void Print(int casenum, int ansflag, double ans){
	printf("Problem #%dn", casenum);
	printf("%c=%.2lf%cn", Concept[ansflag], ans, Unit[ansflag]);
	printf("n");
	return;
}

void Print(question q){
	int pflag = 0;
	switch(q.Name){
		case 'P': {pflag = 0;break;}
		case 'U': {pflag = 1;break;}
		case 'I': {pflag = 2;break;}
		default :break;
	}
	printf("%c=%.2lf%cn", q.Name, q.Value, Unit[pflag]);
	return;
}

void SetUpDataField(string& buf){
	int sz = buf.size();
	int quesnum = 0;
	for (int i = 0; i < sz; i++){
		for (int quesflag = 0; quesflag < 3; quesflag++){
			if (buf[i] == Concept[quesflag]){
				telled[quesnum].Name = buf[i];
				char sbuf[20];memset(sbuf, '', sizeof(sbuf));
				int iter = i + 2, j;//+2的意思是把指针后移两位，这样就把等号“=”也一并不用考虑了
				for (j = 0; !isalpha(buf[iter + j]); j++){
					sbuf[j] = buf[iter + j];
				}
				sscanf(sbuf, "%lf", &telled[quesnum].Value);
				int pflag = 0;
				switch(telled[quesnum].Name){
					case 'P': {pflag = 0;break;}
					case 'U': {pflag = 1;break;}
					case 'I': {pflag = 2;break;}
					default :break;
				}
				const char unit = Unit[pflag];
				switch (buf[iter + j]){
					case 'm':{telled[quesnum].Value /= 1000;break;}
					case 'k':{telled[quesnum].Value *= 1000;break;}
					case 'M':{telled[quesnum].Value *= 1000000;break;}
					default :{
						if (buf[iter + j] == unit)break;
						else continue;
					}
				}
				if (telled[quesnum].Value != Unkn)quesnum++;
			}
		}
		if (quesnum == 2)break;
	}
	return;
}

double Calu(int& ansflag){
	bool aflag[3];
	memset(aflag, 0, sizeof(aflag));
	for (int i = 0; i < 2; i++){
		for (int j = 0; j < 3; j++){
			if (telled[i].Name == Concept[j]){
				aflag[j] = 1;
			}
		}
	}
	for (int i = 0; i < 3; i++){
		if (aflag[i] == 0){
			ansflag = i;
			break;
		}
	}
	double ans = 0;
	switch(ansflag){
		case 0:{ans = telled[0].Value * telled[1].Value;break;}
		case 1:{
			double num1 = (telled[0].Name == 'P')? telled[0].Value: telled[1].Value;
			double num2 = (telled[0].Name == 'I')? telled[0].Value: telled[1].Value;
			ans = num1 / num2;
			break;
		}
		case 2:{
			double num1 = (telled[0].Name == 'P')? telled[0].Value: telled[1].Value;
			double num2 = (telled[0].Name == 'U')? telled[0].Value: telled[1].Value;
			ans = num1 / num2;
			break;
		}
		default :break;
	}
	return ans;
}

void Solve(int casenum){
	int ansflag = 0;
	string buf;getline(cin, buf);
	SetUpDataField(buf);
	double ans = Calu(ansflag);
	Print(casenum, ansflag, ans);
}

int main(){
	int T, tt = 0;
	scanf("%d", &T);
	getchar();//消除回车
	while (T--){
		Solve(++tt);
	}
    return 0;
}{% endhighlight %}

